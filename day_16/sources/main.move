/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   day_16                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: abakirca <ahmetbakircan@gmail.com>         +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*                                                     #+#    #+#             */
/*   Created: 2026/01/12 23:15:50 by abakirca         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

module challenge::day_16
{
	const MAX_PLOTS: u64 = 20;
	const E_PLOT_NOT_FOUND: u64 = 1;
	const E_PLOT_LIMIT_EXCEEDED: u64 = 2;
	const E_INVALID_PLOT_ID: u64 = 3;
	const E_PLOT_ALREADY_EXISTS: u64 = 4;

	public struct FarmCounters has copy, drop, store {
		planted: u64,
		harvested: u64,
		plots: vector<u8>,
	}

	fun new_counters(): FarmCounters {
		FarmCounters {
			planted: 0,
			harvested: 0,
			plots: vector::empty(),
		}
	}

	fun plant(counters: &mut FarmCounters, plotId: u8) {
		assert!(plotId >= 1 && plotId <= (MAX_PLOTS as u8), E_INVALID_PLOT_ID);
		
		let len = vector::length(&counters.plots);
		assert!(len < MAX_PLOTS, E_PLOT_LIMIT_EXCEEDED);

		let mut i = 0;
		while (i < len) {
			let existing_plot = vector::borrow(&counters.plots, i);
			assert!(*existing_plot != plotId, E_PLOT_ALREADY_EXISTS);
			i = i + 1;
		};
		
		counters.planted = counters.planted + 1;
		vector::push_back(&mut counters.plots, plotId);
	}

	fun harvest(counters: &mut FarmCounters, plotId: u8) {
		let len = vector::length(&counters.plots);

		let mut i = 0;
		let mut found_index = len; 
		while (i < len) {
			let existing_plot = vector::borrow(&counters.plots, i);
			if (*existing_plot == plotId) {
				found_index = i;
			};
			i = i + 1;
		};
		assert!(found_index < len, E_PLOT_NOT_FOUND);

		vector::remove(&mut counters.plots, found_index);
		counters.harvested = counters.harvested + 1;
	}

	public struct Farm has key {
		id: UID,
		counters: FarmCounters,
	}

	public fun new_farm(ctx: &mut TxContext): Farm
	{
		let id = object::new(ctx);
		Farm {
			id,
			counters: new_counters(),
		}
	}
}
